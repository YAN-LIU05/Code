@ECHO OFF
:: 设置窗口标题
TITLE 数据分析流水线运行程序

:: ============================================================================
::  此批处理脚本将按顺序运行所有的数据分析流程。
::  在运行前，请确保您已经通过以下命令安装了所有必要的库:
::  pip install -r requirements.txt
:: ============================================================================

ECHO #############################################################
ECHO #             开始运行完整的数据分析流水线             #
ECHO #############################################################
ECHO.
ECHO 在开始之前，请确认您已经打开了命令行 (cmd 或 PowerShell)，
ECHO 进入到当前 "代码" 文件夹，并运行了以下命令来安装依赖库:
ECHO pip install -r requirements.txt
ECHO.
PAUSE
ECHO.

:: ----------------------------------------------------------------------------
::  步骤 0: 运行初步数据清洗脚本
:: ----------------------------------------------------------------------------
ECHO.
ECHO [0/5] 正在执行: 初步数据清洗 (clean.py)...
ECHO =================================================================
py -3 clean.py
:: 检查上一个命令是否成功执行
IF %ERRORLEVEL% NEQ 0 (
    ECHO.
    ECHO *** 错误: 数据清洗脚本 (clean.py) 执行失败! ***
    ECHO 流水线已中断。请检查上方的错误信息。
    ECHO.
    PAUSE
    EXIT /B
)
ECHO =================================================================
ECHO [0/5] 完成: 初步数据清洗成功。
ECHO.


:: ----------------------------------------------------------------------------
::  步骤 1: 运行 Q1 分析模块
:: ----------------------------------------------------------------------------
ECHO.
ECHO [1/5] 正在执行: Q1 分析模块 (Q1_main.py)...
ECHO =================================================================
:: 进入 Q1 文件夹
CD Q1
py -3 Q1_main.py
IF %ERRORLEVEL% NEQ 0 (
    ECHO.
    ECHO *** 错误: Q1 分析脚本执行失败! ***
    ECHO 流水线已中断。请检查上方的错误信息。
    ECHO.
    PAUSE
    EXIT /B
)
:: 返回上级目录
CD ..
ECHO =================================================================
ECHO [1/5] 完成: Q1 分析模块成功。
ECHO.


:: ----------------------------------------------------------------------------
::  步骤 2: 运行 Q2 分析模块
:: ----------------------------------------------------------------------------
ECHO.
ECHO [2/5] 正在执行: Q2 分析模块 (Q2_main.py)...
ECHO =================================================================
CD Q2
py -3 Q2_main.py
IF %ERRORLEVEL% NEQ 0 (
    ECHO.
    ECHO *** 错误: Q2 分析脚本执行失败! ***
    ECHO 流水线已中断。请检查上方的错误信息。
    ECHO.
    PAUSE
    EXIT /B
)
CD ..
ECHO =================================================================
ECHO [2/5] 完成: Q2 分析模块成功。
ECHO.


:: ----------------------------------------------------------------------------
::  步骤 3: 运行 Q3 分析模块 (包含数据清洗)
:: ----------------------------------------------------------------------------
ECHO.
ECHO [3/5] 正在执行: Q3 分析模块...
ECHO =================================================================
CD Q3

ECHO   - 步骤 3a: 运行 Q3 数据清洗 (Q3_clean.py)...
py -3 Q3_clean.py
IF %ERRORLEVEL% NEQ 0 (
    ECHO.
    ECHO *** 错误: Q3 数据清洗脚本 (Q3_clean.py) 执行失败! ***
    ECHO 流水线已中断。请检查上方的错误信息。
    ECHO.
    PAUSE
    EXIT /B
)
ECHO   - 步骤 3a: Q3 数据清洗完成。
ECHO.

ECHO   - 步骤 3b: 运行 Q3 主分析 (Q3_main.py)...
py -3 Q3_main.py
IF %ERRORLEVEL% NEQ 0 (
    ECHO.
    ECHO *** 错误: Q3 主分析脚本 (Q3_main.py) 执行失败! ***
    ECHO 流水线已中断。请检查上方的错误信息。
    ECHO.
    PAUSE
    EXIT /B
)
ECHO   - 步骤 3b: Q3 主分析完成。

CD ..
ECHO =================================================================
ECHO [3/5] 完成: Q3 分析模块成功。
ECHO.


:: ----------------------------------------------------------------------------
::  步骤 4: 运行 Q4 分析模块
:: ----------------------------------------------------------------------------
ECHO.
ECHO [4/5] 正在执行: Q4 分析模块 (Q4_main.py)...
ECHO =================================================================
CD Q4
py -3 Q4_main.py
IF %ERRORLEVEL% NEQ 0 (
    ECHO.
    ECHO *** 错误: Q4 分析脚本执行失败! ***
    ECHO 流水线已中断。请检查上方的错误信息。
    ECHO.
    PAUSE
    EXIT /B
)
CD ..
ECHO =================================================================
ECHO [4/5] 完成: Q4 分析模块成功。
ECHO.


:: ----------------------------------------------------------------------------
::  结束
:: ----------------------------------------------------------------------------
ECHO.
ECHO #############################################################
ECHO #               所有分析流程均已执行完毕。                 #
ECHO #############################################################
ECHO.
ECHO 您可以检查各个文件夹内生成的图表和 Excel 结果文件。
ECHO 按任意键退出此窗口。
ECHO.
PAUSE